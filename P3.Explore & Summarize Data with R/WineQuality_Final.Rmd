---
title: "Red Wine Quality Analysis"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
#Load the Libraries
library(dplyr)
library(ggthemes)
library(ggplot2)
library(ggExtra)
library(readr)
library(reshape2)
library(stats)
library(tibble)
library(tidyr)
library(GGally) # for ggpairs
library(gridExtra) #grid.arrange fn
library(ISLR) #mathematical models
library(caTools)
library(class)
library(e1071)
library(corrplot) # We'll use corrplot later on in this example too.
library(visreg) # This library will allow us to show multivariate graphs.
library(knitr)
library(scatterplot3d)
```

*Written by Savahnna L. Cunningham*

*Date: October 13, 2017*

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Load the Data
wine<- read_csv("~/Desktop/P3.EDA with R/wineQualityReds.csv")

```


The Red Wine dataset is publicly available for research. The details are described in [Cortez et al., 2009].

**P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.**

Available at: 

* [Elsevier](http://dx.doi.org/10.1016/j.dss.2009.05.016)
* [Pre-press (pdf)](http://www3.dsi.uminho.pt/pcortez/winequality09.pdf)
* [bib](http://www3.dsi.uminho.pt/pcortez/dss09.bib)


# Introduction

The goal of this analysis is to quantify and gain an understanding of how chemical properties impact the quality rating of red wine. The dataset contains 1599 red wine samples with 11 variables, quantifying the physicochemical properties of each wine. The wine samples in this dataset are related to red variants of the Portuguese "Vinho Verde" wine.

A multiple regression analysis will be conducted on the dataset to test how changes in the 11 independent physicochemical properties predict a level of change in the quality rating of a wine. The f-test will be used to determine which predictor variables merit inclusion in the model.

The statistical hypotheses for this analysis are as follows: 

H0 (Null Hypothesis): Combinations of the 11 independent physicochemical properties (μI) have no relationship in predicting the outcome of the dependent quality rating of a wine (μD), which can be mathematically represented as

  *H0: μI = μD*  
    
H1 (Alternate Hypothesis): Two or more of the 11 independent physicochemical properties (μI) predict the outcome of the dependent quality rating of a wine (μD), which can be mathematically represented as

  *HA:  μI > μD*



#### Attribute information:

    
       Input variables (based on physicochemical tests):
       
       1 - fixed acidity (tartaric acid - g / dm^3)
       
       2 - volatile acidity (acetic acid - g / dm^3)
       
       3 - citric acid (g / dm^3)
       
       4 - residual sugar (g / dm^3)
       
       5 - chlorides (sodium chloride - g / dm^3
       
       6 - free sulfur dioxide (mg / dm^3)
       
       7 - total sulfur dioxide (mg / dm^3)
       
       8 - density (g / cm^3)
       
       9 - pH
       
       10 - sulphates (potassium sulphate - g / dm3)
       
       11 - alcohol (% by volume)
       
       Output variable (based on sensory data): 
       
       12 - quality (score between 0 and 10)
   
#### Description of attributes:
    
    1 - fixed acidity: most acids involved with wine or fixed or nonvolatile (do not evaporate readily)
    
    2 - volatile acidity: the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste
    
    3 - citric acid: found in small quantities, citric acid can add 'freshness' and flavor to wines
    
    4 - residual sugar: the amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet
    
    5 - chlorides: the amount of salt in the wine
    
    6 - free sulfur dioxide: the free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine
    
    7 - total sulfur dioxide: amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine
    
    8 - density: the density of water is close to that of water depending on the percent alcohol and sugar content
    
    9 - pH: describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale
    
    10 - sulphates: a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant
    
    11 - alcohol: the percent alcohol content of the wine
    
       Output variable (based on sensory data): 
    12 - quality (score between 0 and 10)


------

# Methodology

## Univariate Plots & Analysis 


Summary table representing the 13 variable names. The X1 column represents the wine ID. The 'quality' variable is the dependent variable and is qualitative data based on a perceived like or dislike for the wine sample.


```{r echo=FALSE}
#Distribution summary of the dataset
summary(wine)
```



### Normal Distribution Plots

The following variables have a normal or close-to-normal distribution: fixed.acidity, volatile.acidity, density, pH and alcohol content with the exception of citric acid, which has a bimodal distribution.

```{r fig.width=10, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE}
p1 <- qplot(x = fixed.acidity, data = wine,
            binwidth = 0.1) + 
  scale_x_continuous(breaks = seq(4, 16, 1)) + 
  theme_hc() +
  labs(x='Fixed Acidity (Tartaric Acid - g / dm^3)',y='Frequency')

p2 <- qplot(x = volatile.acidity, data = wine,
            binwidth = 0.1) +
  scale_x_continuous() + 
  theme_hc() + 
  labs(x='Volatile Acidity (Acetic Acid - g / dm^3)',y='Frequency')

p3 <- qplot(x = citric.acid, data = wine,
            binwidth = 0.01) +
  scale_x_continuous(breaks = seq(0, 1, 0.1)) + 
  theme_hc() +
  labs(x='Citric Acid (g / dm^3)',y='Frequency')

p4 <- qplot(x = density, data = wine) + 
  theme_hc()+
  labs(x='Density (g / cm^3)',y='Frequency')
  
p5 <- qplot(x = pH, data = wine) + 
  theme_hc() +
  labs(x='pH',y='Frequency')

p6 <- qplot(x = alcohol, data = wine) + 
  theme_hc() +
  labs(x='Alcohol (% by volume)',y='Frequency')

grid.arrange(p1,p2, p3, p4, p5, p6, ncol = 2)

```


### Abnormal Distributions
The following variables do not have a normal or close-to-normal distribution: residual.sugar, chlorides, free.sulfur.dioxide, total.sulfur.dioxide and sulphates. The variables have right-skewed distributions, thus a logarithmic function will be used to transform the data to get a better understanding of their respective distributions [4].

**Original Data Distribution**


```{r fig.width=10, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE}

p1 <- qplot(x = residual.sugar, data = wine) + theme_hc() + labs(x='Residual Sugar (g / dm^3)',y='Frequency')

p2 <- qplot(x = chlorides, data = wine) + theme_hc() + labs(x='Chlorides (Sodium chloride - g / dm^3)',y='Frequency')

p3 <- qplot(x = free.sulfur.dioxide, data = wine) + theme_hc() + labs(x='Free Sulfur dioxide (mg / dm^3)',y='Frequency')

p4 <- qplot(x = total.sulfur.dioxide, data = wine) + theme_hc() + labs(x='Total Sulfur dioxide (mg / dm^3)',y='Frequency')

p5 <- qplot(x = sulphates, data = wine) + theme_hc() + labs(x='Sulphates (Potassium sulphate - g / dm3)',y='Frequency')

grid.arrange(p1, p2, p3, p4, p5, ncol = 2)
```


**Logarithmic Distribution**

```{r fig.width=10, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE}

p1 <- qplot(x = log10(residual.sugar), data = wine) + theme_hc() + labs(x='Residual Sugar (g / dm^3)',y='Frequency')

p2 <- qplot(x = log10(chlorides), data = wine) + theme_hc() + labs(x='Chlorides (Sodium chloride - g / dm^3)',y='Frequency')

p3 <- qplot(x = log10(free.sulfur.dioxide), data = wine) + theme_hc() + labs(x='Free Sulfur dioxide (mg / dm^3)',y='Frequency')

p4 <- qplot(x = log10(total.sulfur.dioxide), data = wine) + theme_hc() + labs(x='Total Sulfur dioxide (mg / dm^3)',y='Frequency')

p5 <- qplot(x = log10(sulphates), data = wine) + theme_hc() + labs(x='Sulphates (Potassium sulphate - g / dm3)',y='Frequency')



grid.arrange(p1, p2, p3, p4, p5, ncol = 2)
```

As you can see, the logarithmic function helped clean up the distributions. The Free Sulfur Dioxide variable is uniquely distributed with a near bimodal distribution. 


**Synopsis**

The red wine dataset contains 1599 red wine samples comprised of 11 physiochemical variables that affect a wine's perceived quality. The main features of interest are the 11 variables and how they correlate to a wine's quality. 

There were 5 physiochemical variables that had abnormal distributions. A logarithmic function was used to better understanding of the distributions. 

The next step in this analysis with be to investigate the relationship quality has with the physiochemical variables. The variable quality is of numeric type ‘int’ and not conducive for data analysis. The first step will be to change the numeric type of the quality variable to a factor and add it to the data frame as a new variable quality.rating. Additionally, three categories of quality will be added: good (>= 7), bad (<=4), and mediocre (5 and 6).


------


## Bivariate Plots & Analysis 


```{r fig.width=10, fig.height=10, echo=FALSE, message=FALSE, warning=FALSE}
# Resourced R-bloggers for code inspiration [5].

require(datasets)
data("wine")
require(GGally)
require(ggplot2)

corr_plot <- function(data, mapping, ...){
  p <- ggplot(data = wine, mapping = mapping) + 
    geom_point(alpha=0.5) + 
    geom_smooth(method=loess, fill="red", color="red", ...) 
  p
}

g = ggpairs(wine,columns = 2:12, lower = list(continuous = corr_plot))
g + theme_classic() + ggtitle('Correlative relationships between physiochemical characteristics')
```


Density appears to have a small positive correlation with acids. Additionally, pH has an inverse relationship with the acids, which is to be expected. 

The following pairs of independent variables have a strong correlation (>0.5):

* free.sulfur.dioxide vs total sulfur.dioxide
* fixed acidity vs density
* fixed acidity vs pH
* fixed acidity vs citric acid

------

### Exploratory Data Analysis 


The exploratory data analysis will focus on the relationship between the independent variables and the dependent quality rating variable. 

**Creating a Categorical Variable**

```{r}
# Gained inspiration for this code from the R-Bloggers website[6&7].

wine$quality.rating <- factor(wine$quality)
wine$quality.rating <- NA
wine$quality.rating <- ifelse(wine$quality>=7, 'good', NA)
wine$quality.rating <- ifelse(wine$quality<=4, 'bad', wine$quality.rating)
wine$quality.rating<- ifelse(wine$quality==5, 'mediocre', wine$quality.rating)
wine$quality.rating <- ifelse(wine$quality==6, 'mediocre', wine$quality.rating)

wine$quality.rating <- factor(wine$quality.rating, levels = c("bad", "mediocre", "good"))
```


------


#### Independent Variables vs. Quality Rating: A Positive Linear Relationship 


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, alcohol )) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Alcohol Percentage vs Quality Rating') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Alcohol (% by volume)')
```

The visualization indicates good wine contains a higher percentage of alcohol, averaging ~12% by volume.


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, fixed.acidity)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Fixed Acidity vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Fixed Acidity (Tartaric Acid - g / dm^3)')
```


The visualization indicates good wine contains a higher quantity of fixed acidity. As you can see, >8 g/dm³ appears to be the threshold for a wine to be considered good. 


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, citric.acid)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Citric Acid vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Citric Acid (g/dm³)')
```

The visualization indicates good wine contains a higher quantity of citric acid. As you can see, the quality greatly improves if a wine is has a citric acid content range between 0.25 - 0.5 g/dm³.


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, sulphates)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Sulphates vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Sulphates (Potassium sulphate - g / dm3)')
```

The visualization indicates there is not a large separation from a good verses a bad wine. As you can see, it appears as if a good wine will contain a sulphate concentration of ~0.75 g/dm³. 

------


#### Independent Variables vs. Quality Rating: A Negative Linear Relationship 


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, volatile.acidity)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Volatile Acidity vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Volatile Acidity (Acetic Acid - g / dm^3)')
```


The visualization indicates that the greater amount of volatile acidity a wine contains, the worse the quality rating. To have good marks, a wine is considered good if it contains <0.4 g/dm³ acidic acid.

```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating,density)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('Density vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='Density (g/cm³)')
```


The visualization indicates that all wine samples are close to the density of water, however the wine samples with a good quality rating have a slightly lower density, with a value approximately equal to 0.995 g/cm³.


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}
g1 <- ggplot(wine,
  aes(quality.rating, pH)) +
  geom_point() + geom_boxplot() 
g1 + theme_classic() +
      ggtitle('pH vs Quality') + 
      theme(text = element_text(size=12)) +
      labs(x='Quality Rating',y='pH')
```


The visualization indicates that the mediocre and good wine samples are very similar in pH of <= 3.4, while the wine samples with a bad quality rating have a value of >= 3.4.

------

#### pH and the Non-Volatile Acid Variables

```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(aes(x = pH, y = citric.acid), data = wine) + 
  geom_point(alpha = 0.5, position = position_jitter(h = 0), size=4) +
  coord_trans(x = "log10") +
  geom_smooth(method = "lm", color = "red")+ 
  theme_classic() +
  labs(x='pH',y='Citric Acid (g / dm^3)')

g2<- ggplot(aes(x = pH, y = fixed.acidity), data = wine) + 
  geom_point(alpha = 0.5, position = position_jitter(h = 0), size=4) +
  coord_trans(x = "log10") +
  geom_smooth(method = "lm", color = "red")+
  theme_classic() +
  labs(x='pH',y='Fixed Acidity (Tartaric Acid - g / dm^3)')


grid.arrange(g1, g2, ncol = 2)
```

The visualization represents the inverse relationship between pH and the weak acids found in wine. Substances with a pH below 7.0 are termed acidic and solutions with a pH above 7.0 are termed basic. As you can see, the red wine samples as a whole are considered an acidic solution. As pH goes up, the less acidic the wine becomes.


------


#### Density and the Non-Volatile Acid Variables

```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(aes(x = density, y = citric.acid), data = wine) + 
  geom_point(alpha = 0.5, position = position_jitter(h = 0), size=4) +
  coord_trans(x = "log10") +
  geom_smooth(method = "lm", color = "red")+ 
  theme_classic() +
  labs(x='Density (g / cm^3)',y='Citric Acid (g / dm^3)')

g2 <- ggplot(aes(x = density, y = fixed.acidity), data = wine) + 
  geom_point(alpha = 0.5, position = position_jitter(h = 0),size=4) +
  coord_trans(x = "log10") +
  geom_smooth(method = "lm", color = "red") +
  theme_classic() +
  labs(x='Density (g / cm^3)',y='Fixed Acidity (Tartaric Acid - g / dm^3)')

grid.arrange(g1, g2,ncol = 2)

```

The visualization represents the affect acidity has on wine density. Acid molecules are creating a stronger, closely packed bond compared to the surrounding substance. Therefore, as acid molecules increase, the density of the wine also increases. 


**Synopsis**

The Bivariant analysis depicts notable relationships between wine quality and the physiochemical characteristics. As you can see from the boxplots above, there is a positive correlation between fixed acid, citric acid levels and wine quality. The higher the non-volatile acid level, the better the wine quality. Additionally, because acetic acid produces a vinegar taste, a negative correlation can be found between the volatile acid variable and wine quality. 

A good wine has the lowest density, which makes sense because density has a direct correlation with total acidity concentration. However, it is interesting to point out that there seems to be a fine line between total acidity level and pH value. For a wine to be considered good, it has to have a low volatile acidity level in conjunction with higher citric acid and fixed acid concentrations but overall total acid levels should not pass a pH value of ~3.3.
 

------


## Multivariate Plots & Analysis   


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(wine,aes(total.sulfur.dioxide,free.sulfur.dioxide)) + geom_point(position = position_jitter(),aes(color=quality.rating),alpha=0.45,size=3) + 
  geom_smooth(method=lm , color="red", se=TRUE) +
  scale_color_brewer(type = 'div', palette="Set1") +
  theme_classic() + 
  ggtitle('Free Sulfur dioxide vs Total Sulfur dioxide') + 
  theme(text = element_text(size=12)) +
  labs(x='Total Sulfur dioxide (mg / dm^3)', y='Free Sulfur dioxide (mg / dm^3)')
  
print(g1)
```


The visualization compares the free Sulfur dioxide and the total Sulfur dioxide variables to the dependent quality rating variable. As you can see, the majority of "good" wine is located in the lower left quadrant and will have a free Sulfur dioxide of <20 mg / dm^3 and a total Sulfur dioxide concentration of <100 mg / dm^3.


```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(wine,aes(fixed.acidity,pH)) + geom_point(position = position_jitter(),aes(color=quality.rating),alpha=0.45,size=3) + 
  geom_smooth(method=lm , color="red", se=TRUE) +
  scale_color_brewer(type = 'div', palette="Set1") +
  theme_classic() + 
  ggtitle('Fixed Acidity vs pH') + 
  theme(text = element_text(size=12)) +
  labs(x='Fixed Acidity (Tartaric Acid - g / dm^3)', y='pH')
  
print(g1)
```


The visualization compares the Fixed Acidity variable against pH value with based on the dependent quality rating variable. As you can see, there is an inverse relationship between pH and fixed acidity. This is to be expected, as pH levels rise as acidity level decreases.  

```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(wine,aes(fixed.acidity,citric.acid)) + geom_point(position = position_jitter(),aes(color=quality.rating),alpha=0.45,size=3) + 
  geom_smooth(method=lm , color="red", se=TRUE) +
  scale_color_brewer(type = 'div', palette="Set1") +
  theme_classic() + 
  ggtitle('Fixed Acidity vs Citric Acid') + 
  theme(text = element_text(size=12)) +
  labs(x='Fixed Acidity (Tartaric Acid - g / dm^3)',y='Citric Acid (g / dm^3)')
  
print(g1)
```


The visualization compares the Fixed Acidity and Citric Acid variables with the wine quality rating. Results indicate a positive linear relationship between the independent variables. The majority of "good" wine has a Fixed Acidity concentration of less than 9 g / dm^3 and a Citric Acid concentration less than 0.25 g / dm^3.

```{r fig.width=8, fig.height=4, echo=FALSE, message=FALSE, warning=FALSE}

g1 <- ggplot(wine,aes(fixed.acidity,density)) + geom_point(position = position_jitter(),aes(color=quality.rating),alpha=0.45,size=3) + 
  geom_smooth(method=lm , color="red", se=TRUE) +
  scale_color_brewer(type = 'div', palette="Set1") +
  theme_classic() + 
  ggtitle('Fixed Acidity vs Density') + 
  theme(text = element_text(size=12)) +
  labs(x='Fixed Acidity (Tartaric Acid - g / dm^3)',y='Density (g / cm^3)')
  
print(g1)
```


The visualization compares the Fixed Acidity and the Density variables with the wine quality rating. Results indicate a strong positive linear relationship between the independent variables. There does not appear to be any correlative relationship between the independent and dependent variables.   

------


#### Mathematical Model

The goal of the multiple linear regression model is to predict wine quality based on the chemical properties of a wine sample.

```{r}
# Multiple Linear Regression
dataset = read.csv('wineQualityReds.csv')
dataset = dataset[, 2:13]

# Splitting the dataset into the Training set and Test set
# install.packages('caTools')
library(caTools)
set.seed(123)
split = sample.split(dataset$quality, SplitRatio = 0.8)
training_set = subset(dataset, split == TRUE)
test_set = subset(dataset, split == FALSE)


# Note: Feature_Scaling will be taken care of with the function 

# Fitting Multiple Linear Regression to the Training set
regressor = lm(formula = quality ~ .,
               data = training_set)
summary(regressor)
```


```{r message=FALSE, warning=FALSE}
#Predicting the Test set results
y_pred = predict.lm(regressor, newdata = test_set,interval = "prediction",level = 0.95)

p1 <- smoothScatter(y_pred,pch = ".", cex = 5, 
                     col = "black",colramp = 
                     colorRampPalette(c("white", blues9)),
                     xlab = "Fit", 
                     ylab = "Model Prediction",
                     main="Predicted Future Values ")

```


The visualization represents the 95% prediction interval with data points 
representing the models predicted values. As you can see, the model did very well 
predicting the wine quality value, as all data points are within the prediction interval [10]. 


```{r fig.width=5, fig.height=5, message=FALSE, warning=FALSE}
# Plot a correlation matrix
regressor= cor(test_set[1:12])

par(mar=c(5,4,1.5,2) + 0.1)  #margin padding  
p1 <- corrplot(regressor, method = "circle",tl.cex = 0.6) + title(main= "Regression Model Correlation Matrix",cex.main = 1.3) 

```


The volatile acidity, chlorides, total sulfur dioxide, alcohol, sulphates
have strong statistical significance on the depandent variable, while pH 
has a slight statistical influence on quality. The model did very well, now it is time to optimize it with the Backward Elimination method.


#### Model Optimization

```{r}

# Building the optimal model using Backward Elimination
regressor = lm(formula = quality ~ fixed.acidity + 
                 volatile.acidity + 
                 citric.acid + 
                 residual.sugar + 
                 chlorides +
                 free.sulfur.dioxide + 
                 total.sulfur.dioxide + 
                 density + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)
```


```{r eval=FALSE, echo=FALSE}
#Interation #2
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 citric.acid + 
                 residual.sugar + 
                 chlorides +
                 free.sulfur.dioxide + 
                 total.sulfur.dioxide + 
                 density + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)

#Interation #3
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 citric.acid + 
                 residual.sugar + 
                 chlorides +
                 free.sulfur.dioxide + 
                 total.sulfur.dioxide + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)

#Interation #4
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 citric.acid + 
                 chlorides +
                 free.sulfur.dioxide + 
                 total.sulfur.dioxide + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)


#Interation #5
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 chlorides +
                 free.sulfur.dioxide + 
                 total.sulfur.dioxide + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)


#Interation #6
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 chlorides +
                 total.sulfur.dioxide + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)
```


```{r echo=FALSE}
#Interation #6
regressor = lm(formula = quality ~ 
                 volatile.acidity + 
                 chlorides +
                 total.sulfur.dioxide + 
                 pH +
                 sulphates +
                 alcohol,
               data = dataset)  
summary(regressor)
```


**Synopsis**

The Multivariate analysis reveals strong statistical correlations with six of the independent physicochemical properties. The scatterplot visualizations indicate that "good" wine will have low concentrations Citric Acid, Tartaric Acid, total Sulfur dioxide and free Sulfur dioxide. 

An optimized multiple linear regression model using the Backward Elimination method discovered alcohol, volatile acidity, sulphates, total sulfur dioxide, chlorides and pH have a very strong statistical influence on wine quality.


------


# Results  

The univariate analysis revealed six independent physicochemical properties have normal or close-to-normal distributions, while the remaining five properties have right-skewed distributions, requiring a logarithmic function be used to better understand the distributions.

The bivariate analysis revealed a positive linear relation between the independent physicochemical properties alcohol, fixed acidity, citric acid and sulphates and the dependent variable. A negative linear relationship exists between volatile acidity, density, pH and the quality rating. An inverse relationship exists between pH and the acids, as pH levels rise as acid levels decrease. Additionally, there is a positive correlation between density and the acids due the chemical properties that exist between an acid molecule and the surrounding substance.  Strong correlations (>0.5) were discovered between free Sulfur dioxide and total Sulfur dioxide, fixed acidity and density, fixed acidity and pH, as well as fixed acidity and citric acid.

A multiple linear regression model was used on a test set of 321 wine samples, containing 11 independent variables to predict wine quality. The model performed very well with a 95% Confidence Interval, p-value <2.2e-16, residual standard error of 0.6519 on 1266 degrees of freedom, and a F-statistic equal to 62.48 on 11 variables and 1266 DF, concluding the 11 variables account for 35.48% of the variance in wine quality. 

A second multiple linear regression model utilizing the Backward Elimination method was conducted on a test set of 321 wine samples to optimize the predictor variables to determine which variables have the strongest statistical relationship with the dependent variable.

*Optimized Multiple Linear Regression Summary:* 

* Confidence Interval = 95%
* α = .05
* Degrees of Freedom = 1593
* Adjusted R-squared:  0.3495
* F-statistic: 147.4 on 6 variables and 1592 DF
* p-value = < 2.2e-16

The Backward Elimination method indicates alcohol, volatile acidity, sulphates, total sulfur dioxide, chlorides and pH physicochemical properties have a very strong statistical influence on wine quality with a 95% Confidence Interval, a p-value <2.2e-16 and a residual standard error of 0.6487 on 1592 degrees of freedom. These six physicochemical properties account for 34.95% of the variance of wine quality. The high F-statistic equal to 147.4 and small p-value of  < 2.2e-16 gives sufficient statistical evidence that the six independent variables predict the quality rating of wine, therefore, the Null Hypothesis can be rejected.


------


#Final Plots and Summary


**Plot One**

```{r echo=FALSE, message=FALSE, warning=FALSE}
g8 <- ggplot(data=wine, aes(wine$quality)) + 
  geom_histogram(stat = 'count',
                 position = "dodge",
                 fill = "#cc0000", 
                 binwidth = 1) + 
  theme_dark()+
  ggtitle('Raw Quality Score Histogram') + 
  theme(text = element_text(size=10)) +
  labs(x='Raw Quality Score',y='Frequency')

g9 <- ggplot(data=wine, aes(wine$quality.rating)) + 
  geom_histogram(stat = 'count',
                 position = "dodge",
                 fill = "#cc0000", 
                 binwidth = 1) + 
  theme_dark()+
  ggtitle('Categorical Quality Rating Histogram') + 
  theme(text = element_text(size=10)) +
  labs(x='Quality Rating',y='Frequency')

```

```{r fig.width=10, fig.height=4,echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(g8,g9, nrow=1) 
```


The visualizations represent the distribution of the dependent variable analyzed in the dataset. The plot on the left is a histogram of a wine samples raw quality score. As you can see, most of the wine samples have a score between 5 and 6. The raw quality data was transformed into a categorical data points to better analyze the information. Score with values of 4 or less were labeled as "bad"", score between 5-6 were labeled as "mediocre" and score with a 7 or higher were labeled "good". The visualization on the right is depicts the categorical distribution of the quality score. As you can see, nearly all wine samples fall into the mediocre category with "good" samples having ~250 samples in the dataset and "bad" wine being the least common.


**Plot Two**


```{r echo=FALSE, message=FALSE, warning=FALSE }

g10 <- ggplot(wine,
  aes(quality.rating, alcohol )) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") + 
  theme_dark() +
  ggtitle('Alcohol Percentage vs Quality Rating') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='Alcohol (% by volume)')

g11 <- ggplot(wine,
  aes(quality.rating, volatile.acidity)) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") + 
  theme_dark() +
  ggtitle('Volatile Acidity vs Quality') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='Volatile Acidity (Acetic Acid - g / dm^3)')

g12 <- ggplot(wine,
  aes(quality.rating,log10(sulphates))) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") +
  theme_dark() +
  ggtitle('Sulphates vs Quality') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='Sulphates (Potassium sulphate (g/dm³)')

g13 <- ggplot(wine,
  aes(quality.rating,log10(total.sulfur.dioxide))) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") + 
  theme_dark() +
  ggtitle('Total Sulfur dioxide vs Quality') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='Total Sulfur dioxide (mg / dm^3)')

g14 <- ggplot(wine,
  aes(quality.rating, log10(chlorides))) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") + 
  theme_dark() +
  ggtitle('Chlorides vs Quality') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='Chlorides (Sodium chloride - g / dm^3)')

g15 <- ggplot(wine,
  aes(quality.rating, pH)) +
  geom_point() + 
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75),fill = "white", colour = "#cc0000") + 
  theme_dark() +
  ggtitle('pH vs Quality') + 
  theme(text = element_text(size=8)) +
  labs(x='Quality Rating',y='pH')
  
```


```{r fig.width=10, fig.height=6,echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(g10,g11,g12,g13,g14,g15, nrow=2) 
```


A multiple linear regression model was conducted on the dataset using the backward elimination method. The findings indicate six independent variables have a high statistical influence (p < 0.05) on the quality of a wine.  A violin plot was used to visualize the descriptive statistics of each influential variable. Take notice that in some cases such as total Sulphur dioxide, chlorides, and pH the distance between a "good" vs. "bad" wine is minute. However, the three independent variables with the greatest statistical influence, alcohol, volatile acidity and sulphates, do have a noticeable distance in mean quality rating values. The results indicate that a good wine will have a high alcohol percentage, low volatile acid concentration and a Potassium sulphate concentration of ~15 g/dm³.


**Plot Three**

```{r fig.width=8, fig.height=4,echo=FALSE, message=FALSE, warning=FALSE}

g16 <- ggplot(wine, aes(x=(wine$volatile.acidity),y=(wine$alcohol))) +
  geom_point(aes(colour = quality.rating),
             alpha = 0.7, 
             position = position_jitter(width = 0.2, height = 0.1), 
             size=3.5)

g16 + scale_colour_brewer(palette = "Reds") + 
  theme_dark() + ggtitle('Alcohol vs Volatile Acidity') + 
  theme(text = element_text(size=8)) +
  labs(x='Volatile Acidity (Acetic Acid - g / dm^3)',y='Alcohol (% by volume)')+
  scale_x_continuous(limits = c(0, 1.75)) +
  scale_y_continuous(limits = c(8, 16))
  
```


The visualization was created to compare the two independent variables with the highest statistical influence on wine quality. As you can see, most "good" wine is located in the upper left quadrant of the graph, while "bad" wine is more dispersed but has a majority in the lower right quadrant. In summary, "good" wine will contain a low concentration of Acetic Acid, ideally <0.5 g / dm^3 and an alcohol content >12% by volume. 


###Summary
The exploratory data analysis revealed the distributions of the 11 independent variables, as well as the interactions the physicochemical properties have with each other. The multivariate analysis focused on the independent variables with strong correlations (>0.5), results showing the fixed acidity variable, with three relations, has the greatest number of correlative influence on other independent variables.  

The dependent wine quality variable has a normal distribution with most samples having a 5-6 quality score. The alcohol content and volatile acidity concentration have the strongest statistical influence on the dependent variable with sulphates, total sulfur dioxide, chlorides and pH also having an influence on the quality of a wine. Interestingly, when the two most influential variables, alcohol content and volatile acidity, are compared with the wine quality rating variable results show “good” wine has an alcohol content >12% by volume and an Acetic Acid concentration <0.5 g / dm3. Future work on this dataset should include exploring the outliers in this analysis. Why does a wine with a high alcohol percentage and a high Acetic Acid concentration still considered a “good” wine? Is there a unique combination of physicochemical properties within these samples, which lead to these abnormal quality ratings?

The mathematical algorithm chosen for this dataset was a multiple linear regression model.  The results of the mathematic model indicate the two most influential variables on a wine’s quality are the alcohol content and volatile acidity concentration with four other also having an influence. However, the model is not without limitations. The model is built with limited data; for example the wine quality scores only range from 3-8. A greater sample size with a wider range in quality scores would significantly improve the model’s robustness. Additionally, the dependent variable is a qualitative measure base on a wine judge’s opinion. Would the quality scores change if the wine samples were given to a population of amateurs to judge? In summary, a greater sample size with a wider range in quality scores and a quantitative wine rating system would greatly improve the algorithms predictive power of the model.


------


# Reflection

This analysis used a multiple linear regression model to account for 34.95% of the variance of wine quality. To improve the predictive power of the mathematical algorithm additional data with a wider spread of quality data should be used to improve performance results. Moreover, additional predictive models should be employed, such as Support Vector Machine (SVM), Decision Tree Regression or K-Nearest Neighbors (KNN) to provide more accurate predictions for a wine's quality as a function of the independent physicochemical properties.

The multiple linear regression model determined the independent physicochemical properties with the highest statistical influence on wine quality are alcohol percentage, volatile acidity, sulphates, total sulfur dioxide, chlorides and pH.  Sulphates are added to wine and act as an antimicrobial and antioxidant, signifying good wines will have a Potassium sulphate concentration of ~0.6 g / dm^3. Furthermore, it was discovered good wines contain low quantities of chlorides, total Sulfur dioxide and pH. The independent variables that have the maximum statistical influence on a wine quality are volatile acidity and alcohol percentage. Therefore, good wines will consist of a high alcohol percentage and a low concentration of volatile acids, which give wines an unpleasant, vinegar taste. This analysis exposes a strong correlative relationship between the physicochemical properties of alcohol and volatile acidity, thus, demonstrating the importance of a wine to be free of imperfections. 


------


### References

    1. Paulo Cortez, António Cerdeira, Fernando Almeida, Telmo Matos, José Reis,
        Modeling wine preferences by data mining from physicochemical properties, 
        In Decision Support Systems, Volume 47, Issue 4, 2009, Pages 547-553, ISSN 0167-9236,                                        https://doi.org/10.1016/j.dss.2009.05.016. 
        (http://www.sciencedirect.com/science/article/pii/S0167923609001377)
      
      2. Dataset link: http://www3.dsi.uminho.pt/pcortez/dss09.bib
      
      3. http://r4stats.com/examples/graphics-ggplot2/
      
      4. http://datadrivenjournalism.net/resources/when_should_i_use_logarithmic_scales_in_my_charts_and_graphs
      
      5.https://www.r-bloggers.com/multiple-regression-lines-in-ggpairs/
      
      6.https://stat.ethz.ch/R-manual/R-devel/library/base/html/levels.html
          
      7. https://www.r-bloggers.com/from-continuous-to-categorical/
      
      8.http://www.shonscience.com/unit-1-earth-as-a-system2/does-the-shape-size-or-temperature-of-matter-affect-its-density
      
      9. https://machinelearningmastery.com/pre-process-your-dataset-in-r/
      
      10. http://www.stat.columbia.edu/~martin/W2024/R6.pdf
      
      11. http://data.library.virginia.edu/diagnostic-plots/
      
      12. https://www.stat.berkeley.edu/classes/s133/Lr.html
      
  
  






